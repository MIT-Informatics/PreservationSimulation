# extract instruction file for extractvalues.py
# RBLandau 20141125, revised 20141130, revised 20150609, revised 20160216,
#  revised 20170109 and 20170110 and 20170121 and 2017013 and 20170514
#  and 20171127 and 20180826.

# O U T P U T   L I N E   T E M P L A T E 
# In the template line, all the variable names must be extracted (successfully)
#  by a line in the variables section below.  
# The template given here should always be blank-separated.  The extract program
#  can use a different separator if the user wishes.  

=template
{timestamp} {docsize} {shelfsize} {copies} {lifem} {simlength} {seed} {lost} {docstotal} {docsokay} {docsrepairedmajority} {docsrepairedminority} {docslost} {auditcycles} {auditfrequency} {auditsegments} {audittype} {auditrepairs} {auditmajority} {auditminority} {auditlost} {glitchfreq} {glitchimpact} {glitchdecay} {glitchmaxlife} {nglitches} {serverdefaultlife} {shockfreq} {shockimpact} {shockmaxlife} {shockspan} {shocktype} {nshocks} {deadserversactive} {deadserversall} {walltime} {cputime} {logfilename} {logfilesize} {instructionfilename} {todaysdatetime} {extractorversion} {cpuinfo} {mongoid}

# The header line will be output or not, depending on the 
#  --header CLI option or the "header" environment variable.  
# Bzzzt: new news: a header spec here is now irrelevant.  The 
#  header output will be just the template with the braces stripped.  

# R U L E S   F O R   R E G E X E S 
# BE VERY CAREFUL constructing the regular expressions for this file.
# The LINEregexes must match ONLY THE SINGLE LINE you want.  Take care
#  (1) to construct the output lines so that it is possible to identify
#  them uniquely with simple regexes; and 
#  (2) to keep the lineregexes really simple.  
#  Note that re.search is used to match lines, so the regex does not 
#  have to begin at the beginning of the line.
#  Regexes may be enclosed in double quotes BUT NOT in single quotes.
#  If a regex contains a vertical bar, it must be escaped with backslash
#  so that it does not look like alternative choices.  The cheap way to 
#  do this is to skip over the vertical bar with a dot.  
# The VALUEregexes are there for grouping only, to extract the string
#  (usually a number) that you want.  Use the least specific expression
#  that works.
#  If a valueregex contains a vertical bar, it MUST be enclosed in 
#  single quotes (apostrophes).  
#  I used to think that it COULD be enclosed in single quotes, but 
#  recent experience says that it must not be in single quotes.  
#  It MUST NOT be enclosed in double quotes, don't ask me why.  
#  To avoid the problems with vertical bars, mainly I just use dots
#  to skip over them.  
# If the word number for the valueregex is zero (0), then the 
#  entire line is used.  Sometimes it is easier to find a field
#  with regex context than to count reliably past five. Not kidding. 


# V A R I A B L E   E X T R A C T I O N   R E G E X E S 
# CSV section specifying where to get the variables for output.
=variables
varname,lineregex,wordnumber,valueregex

# D O C S I Z E 
# The docsize here assumes that the quality=1 doc is 100% some size.
docsize,"DOCUMENT value.1.*percent.100",8,(\d+)

# C O P I E S 
# And, similarly, that we are concerned only how many copies of 
#  quality=1 docs.  
copies,"PARAMS INFO.*DISTRIBUTION.*value.1",8,(\d+)

# S H E L F S I Z E 
# The shelfsize is rarely changed, but sometimes.  Take it from the 
#  first server, since they are all the same.
shelfsize,"created server.V1. quality",0,shelfsize.(\d+)

# S E C T O R   L I F E T I M E 
# Changed the name from "ber" to "lifek" to signal that this is really
#  the sector lifetime in kilo-hours.  Since this number is 
#  well up in the thousands itself, that's millions of hours total.  
#  (ber = Bit Error Rate is a thing of the past.)
#  (Also note that this is exponential expected lifetime, which 
#  differs from half-life by a factor of ln(2).)
# BZZZT: all lifetimes here changed from exponential mean lifetimes to 
#  half-lives 2016Q1.
lifek,"PARAMS INFO.*SHELF.*quality.1",7,smallfailrate.(\d+)
lifem,"PARAMS INFO.*SHELF.*quality.1",7,smallfailrate.(\d+)\d{3}
simlength,"PARAMS INFO.*begin simulation.*timelimit",7,timelimit.(\d+)

# R A N D O M  S E E D 
# Include the seed so that we can recover the original log filename if needed.
# And, oh, by the way, so we can reproduce the results.  
seed,"PARAMS INFO.*random seed",7,seed.(\d+)

# M O N G O D B   _ I D 
# Include the MongoDB _id field so we can declare a job done.  
# BZZZT! New news.  Since the instructions are not stored in MongoDB anymore, 
#  a similar ID is generated by searchspace and still called _id.  But the
#  name "mongoid" is all over the place, so don't change it.
mongoid,"Command line",0,--mongoid=.([0-9a-fA-F_.]+)

# L O S S E S 
# How many docs lost, according to the final evaluation.  
lost,NEWS,16,(\d+)

# D O C U M E N T S  A N D   R E P A I R S 
# Document Collection statistics, again assuming only one collection.
docstotal,COLLECTIONTOTALS,9,ndocs.(\d+)
docsokay,COLLECTIONTOTALS,10,nokay.(\d+)
docsrepairedmajority,COLLECTIONTOTALS,11,nmajority.(\d+)
docsrepairedminority,COLLECTIONTOTALS,12,nminority.(\d+)
docslost,COLLECTIONTOTALS,13,nlost.(\d+)

# A U D I T S 
audittype,"PARAMS INFO.*AUDIT.*type",9,type.([A-Za-z]+)
auditcycles,AUDITTOTALS,6,ncycles.(\d+)
auditfrequency,AUDITTOTALS,7,nfrequency.(\d+)
auditsegments,AUDITTOTALS,8,nsegments.(\d+)
auditrepairs,AUDITTOTALS,9,nrepairs.(\d+)
auditmajority,AUDITTOTALS,10,nmajority.(\d+)
auditminority,AUDITTOTALS,11,nminority.(\d+)
auditlost,AUDITTOTALS,12,nlost.(\d+)

# G L I T C H E S 
glitchfreq,"PARAMS INFO - GLITCH",6,freq.(\d+)
glitchimpact,"PARAMS INFO - GLITCH",7,impact.(\d+)
glitchspan,"PARAMS INFO - GLITCH",8,span.(\d+)
glitchdecay,"PARAMS INFO - GLITCH",9,decay.(\d+)
glitchmaxlife,"PARAMS INFO - GLITCH",10,maxlife.(\d+)
nglitches,"LIFETIME Total glitches",7,glitches.(\d+)

# S H O C K S 
serverdefaultlife,"PARAMS INFO.*Default",6,DefaultHalflife.(\d+)
shockfreq,"PARAMS INFO - SHOCKS",6,freq.(\d+)
shockimpact,"PARAMS INFO - SHOCKS",7,impact.(\d+)
shockspan,"PARAMS INFO - SHOCKS",8,span.(\d+)
shockmaxlife,"PARAMS INFO - SHOCKS",9,maxlife.(\d+)
shocktype,"PARAMS INFO - SHOCKS",10,type.(\d+)
nshocks,"MAIN INFO - SHOCKS Total shocks",7,shocks.(\d+)

# D E A D   S E R V E R S 
deadserversall,"DEADSERVERS ALL",7,n.(\d+)
deadserversactive,"DEADSERVERS ACTIVE",7,n.(\d+)

# T I M E S 
timestamp,"MAIN INFO.*Simulation parameters",1,([1234567890_]+)
walltime,"MAIN.*End time stats",0,wall. *([0-9\.]+)
cputime,"MAIN.*End time stats",0,cpu. *([0-9\.]+)

#END
